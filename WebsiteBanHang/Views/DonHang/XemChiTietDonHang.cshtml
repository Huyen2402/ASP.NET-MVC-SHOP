@using WebsiteBanHang.Models
@model List<ChiTietDonDatHang>


@{
    ViewBag.Title = "XemChiTietDonHang";
    Layout = "~/Views/Layout/SearchLayout.cshtml";
    string MaDDH = ViewBag.MaDDH;
}

<div id="chitiet" class="container mt-3">

    <h1 class="text-center">Chi tiết đơn hàng @MaDDH</h1>

    <table class="table table-light table-hover table-bordered " style="z-index:99999;">
        <thead>
            <tr>
                <th>STT</th>

                <th>Tên Sản Phẩm</th>
                <th>Hình Ảnh</th>
                <th>Số Lượng</th>
                <th>Đơn giá</th>
                <th>Đánh giá sản phẩm</th>
                @*<th>Thao Tác</th>*@

            </tr>
        </thead>
        <tbody>

            @foreach (var item in Model)
            {
                decimal? tien = item.DonGia;



                <tr>
                    <td>@item.MaChiTietDDH1</td>

                    <td>@item.TenSP</td>
                    <td><img class="img-report" src="@Url.Content("~/Content/images/"+item.SanPham.HinhAnh)" alt="Alternate Text" /></td>
                    <td>@item.SoLuong</td>

                    <td>@tien.Value.ToString("#,##0")</td>
                    <td style="display: none">
                        <input class="valDanhGia" data-id="@item.MaDDH" type="hidden" id="txb-idDDH" name="name" value="@item.MaChiTietDDH1" />
                    </td>


                    <td>
                        @if (item.DanhGia != 0 && item.DanhGia == 5 || item.DanhGia != null && item.DanhGia == 5)
                        {


                            <div class="stars">

                                <form action="">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        <p data-start="@i" class="star @i star-5"><i style="color: #FD4" class="fa  fa-star "></i></p>
                                    }

                                    

                                </form>
                            </div>
                        }
                        else if (item.DanhGia != 0 && item.DanhGia < 5 || item.DanhGia != null && item.DanhGia < 5)
                        {
                            <div class="stars">

                                <form action="">
                                    @{
                                        double? noStar = 5 - item.DanhGia;

                                    }
                                    @for (double? i = 1; i <= noStar; i++)
                                    {
                                        <p data-start="@i" class="star @i star-5"><i class="fa-regular  fa-star "></i></p>
                                    }

                                    @for (double? i = 1; i <= item.DanhGia; i++)
                                    {
                                        <p data-start="@i" class="star @i star-5"><i style="color: #FD4" class="fa  fa-star "></i></p>
                                    }




                                </form>
                            </div>
                        }
                                        else
                                        {
                            <div class="stars">
                                <form action="">
                                    <p data-start="5" class="star 5 star-5"><i class="fa-regular  fa-star "></i></p>
                                    <p data-start="4" class="star 4 star-4"><i class="fa-regular fa-star"></i></p>
                                    <p data-start="3" class="star 3 star-3"><i class="fa-regular fa-star"></i></p>
                                    <p data-start="2" class="star 2 star-2"><i class="fa-regular fa-star"></i></p>
                                    <p data-start="1" class="star 1 star-1"><i class="fa-regular fa-star"></i></p>
                                  
                                </form>
                            </div>
                        }


                    </td>



                </tr>


            }

        </tbody>
    </table>
</div>
<style>
    .img-report {
        width: 250px;
    }

    div.stars {
        display: inline-block;
    }

    input.star {
        display: none;
    }

    p.star {
        float: right;
        padding: 10px;
        font-size: 13px;
        color: #444;
        transition: all .2s;
    }
        /*
    input.star:checked ~ label.star:before {
        content: '\f005';
        color: #FD4;
        transition: all .25s;
    }*/

        /*   input.star-5:checked ~ label.star:before {
        color: #FE7;
        text-shadow: 0 0 20px #952;
    }

    input.star-1:checked ~ label.star:before {
        color: #F62;
    }*/

        p.star:hover {
            transform: rotate(-15deg) scale(1.3);
        }

    /* p.star:before {
        content: '\f006';
        font-family: FontAwesome;
    }*/

</style>
<script>
    var arr = []
    $(".star").click(function () {

        Swal.fire({
            title: 'Đánh giá sản phẩm',
            text: "Bạn đã chắc chắn với đánh giá của mình?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes'
        }).then((result) => {
            if (result.isConfirmed) {

                var start = $(this).attr("data-start")
                var MaCTDDH = $(".valDanhGia").val();
                console.log(start)

                $.ajax({
                    type: "get",

                    url: "http://localhost:62979/DonHang/evaluateProduct?MaCTDDH=" + MaCTDDH + "&star=" + start,
                    contentType: "json",

                    success: function (status, data) {
                        console.log("status", status)
                        console.log("data", data)
                        for (var i = 1; i <= start; i++) {
                            $("." + i).empty();
                            $("." + i).prepend('<i style="color:#FD4" class="fa  fa-star "></i>');
                        }
                        Swal.fire(
                            'Thành công!',
                            'Đánh giá của bạn đã góp phần giúp shop chúng tôi ngày càng phát triển tốt hơn.',
                            'success'
                        )

                    }
                })


            }
        })



    })


</script>

